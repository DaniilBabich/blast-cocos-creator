window.__require=function e(o,t,n){function r(c,i){if(!t[c]){if(!o[c]){var u=c.split("/");if(u=u[u.length-1],!o[u]){var l="function"==typeof __require&&__require;if(!i&&l)return l(u,!0);if(s)return s(u,!0);throw new Error("Cannot find module '"+c+"'")}c=u}var a=t[c]={exports:{}};o[c][0].call(a.exports,function(e){return r(o[c][1][e]||e)},a,a.exports,e,o,t,n)}return t[c].exports}for(var s="function"==typeof __require&&__require,c=0;c<n.length;c++)r(n[c]);return r}({bombs:[function(e,o){"use strict";cc._RF.push(o,"00581Y34LRD7bWKkDx8VfHW","bombs");var t=e("config");e("logic"),cc.Class({extends:cc.Component,properties:{label:{default:null,type:cc.Node},count:{default:null,type:cc.Node}},onLoad:function(){this.bombsCount=t.startBombsCount,this.bombsCountRender()},bombsCountRender:function(){this.count.getComponent(cc.Label).string=this.bombsCount},changeBombsLabelColor:function(e){switch(e){case!0:this.label.color=t.bombsOnColor;break;case!1:this.label.color=t.bombsOffColor}},reduceBombsCount:function(){this.bombsCount-=1,this.bombsCountRender()}}),cc._RF.pop()},{config:"config",logic:"logic"}],config:[function(e,o){"use strict";cc._RF.push(o,"ef3b7xSA+tFp4jC9J6l0/F3","config"),o.exports={rowsCount:9,columnsCount:9,cellWidth:171,cellHeight:192,colors:["red","green","blue","yellow","purple"],minCubesCountForDestroy:2,minCubesCountForSuper:5,timePerCell:.15,timeToGoal:.3,timeOfScoreStep:.05,startBombsCount:5,bombsRadius:1,bombsOnColor:new cc.Color(0,255,10),bombsOffColor:new cc.Color(255,255,255),startGoalNumber:50,startMoves:30,pointsPerCube:100},cc._RF.pop()},{}],cubes:[function(e,o){"use strict";function t(e,o){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=n(e))||o&&e&&"number"==typeof e.length){t&&(e=t);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}function n(e,o){if(e){if("string"==typeof e)return r(e,o);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?r(e,o):void 0}}function r(e,o){(null==o||o>e.length)&&(o=e.length);for(var t=0,n=new Array(o);t<o;t++)n[t]=e[t];return n}cc._RF.push(o,"22280sD3pZFn4YSpZMmz276","cubes");var s=e("config"),c=e("logic");cc.Class({extends:cc.Component,properties:{cube:{default:null,type:cc.Prefab},red:{default:null,type:cc.SpriteFrame},green:{default:null,type:cc.SpriteFrame},blue:{default:null,type:cc.SpriteFrame},yellow:{default:null,type:cc.SpriteFrame},purple:{default:null,type:cc.SpriteFrame},super:{default:null,type:cc.SpriteFrame},goal:{default:null,type:cc.Node},moves:{default:null,type:cc.Node},score:{default:null,type:cc.Node},bombs:{default:null,type:cc.Node},game:{default:null,type:cc.Node},persist:{default:null,type:cc.Node}},onLoad:function(){c.init(),this.renderCubes(),this.runOnloadAnimation()},renderCubes:function(e){var o=this;this.node.parent.getComponent(cc.Mask).enabled=!0,this.eventsOff();for(var n,r=0,i=t(this.node.children);!(n=i()).done;)n.value.destroy();for(var u=0;u<s.rowsCount;u++)for(var l=0;l<s.columnsCount;l++){var a=cc.instantiate(this.cube);a.getComponent(cc.Sprite).spriteFrame=this[c.cubes[u][l].color],a.x=s.cellWidth*l,a.y=s.cellHeight*u,a.parent=this.node,c.cubes[u][l].prevRow&&(a.y=s.cellHeight*c.cubes[u][l].prevRow,cc.tween(a).to((c.cubes[u][l].prevRow-u)*s.timePerCell,{position:cc.v2(a.x,s.cellHeight*u)}).call(function(){(r+=1)===e&&o.callbackToAnimationsBeforeNewMove()}).start())}},runOnloadAnimation:function(){this.node.y=-this.node.y,cc.tween(this.node).to(s.rowsCount*s.timePerCell,{position:cc.v2(this.node.x,-this.node.y)}).call(this.callbackToAnimationsBeforeNewMove,this).start()},callbackToAnimationsBeforeNewMove:function(){this.node.parent.getComponent(cc.Mask).enabled=!1,this.eventsOn(),c.deletePrevRows(),c.isAvailableMoves()||(c.reshuffleCubes(),this.renderCubes(),this.runOnloadAnimation())},eventsOn:function(){for(var e,o=t(this.node.children);!(e=o()).done;){var n=e.value;"super"===n.getComponent(cc.Sprite).spriteFrame.name?n.on(cc.Node.EventType.MOUSE_DOWN,this.superCubeOn,this):n.on(cc.Node.EventType.MOUSE_DOWN,this.cubeOn,this)}this.bombs.on(cc.Node.EventType.MOUSE_DOWN,this.bombsOn,this)},eventsOff:function(){for(var e,o=t(this.node.children);!(e=o()).done;){var n=e.value;n.off(cc.Node.EventType.MOUSE_DOWN,this.cubeOn,this),n.off(cc.Node.EventType.MOUSE_DOWN,this.bombCubeOn,this),n.off(cc.Node.EventType.MOUSE_DOWN,this.superCubeOn,this)}this.bombs.off(cc.Node.EventType.MOUSE_DOWN,this.bombsOn,this),this.game.off(cc.Node.EventType.MOUSE_DOWN,this.bombsOff,this)},cubesEvent:function(e,o){var n=this,r=c.getCubesToDestroy(e.y/s.cellHeight,e.x/s.cellWidth,o);r.length>=s.minCubesCountForDestroy&&function(){var e=c.getGoalCubes(r);!o&&r.length>=s.minCubesCountForSuper&&c.saveSuperCube(r),c.calculateCubesChanges(r);var i=c.getPrevRowsCount();if(e.length){n.eventsOff();for(var u,l=function(){var e=u.value;e.color!==c.goalColor&&n.node.children.find(function(o){return o.x/s.cellWidth===e.column&&o.y/s.cellHeight===e.row}).destroy()},a=t(r);!(u=a()).done;)l();for(var b,f=function(){var t=b.value,r=n.node.children.find(function(e){return e.x/s.cellWidth===t.column&&e.y/s.cellHeight===t.row});cc.tween(r).to(0,{zIndex:1}).to(s.timeToGoal,{position:cc.v2(800,2e3),width:r.width/2,height:r.height/2},{easing:"quartIn"}).call(function(){n.renderCubes(i),n.goal.getComponent("goal").goalProgress(e.length),n.score.getComponent("score").scoreProgress(e.length),"bomb"!==o&&n.moves.getComponent("moves").movesReduce()}).start()},p=t(e);!(b=p()).done;)f()}else n.renderCubes(i),"bomb"!==o&&n.moves.getComponent("moves").movesReduce()}()},cubeOn:function(e){this.cubesEvent(e.target)},superCubeOn:function(e){this.cubesEvent(e.target,"super")},bombCubeOn:function(e){this.cubesEvent(e.target,"bomb"),this.bombs.getComponent("bombs").changeBombsLabelColor(!1),this.bombs.getComponent("bombs").reduceBombsCount()},bombsOn:function(){if(this.bombs.getComponent("bombs").bombsCount>0){this.bombs.getComponent("bombs").changeBombsLabelColor(!0);for(var e,o=t(this.node.children);!(e=o()).done;){var n=e.value;n.off(cc.Node.EventType.MOUSE_DOWN,this.cubeOn,this),n.off(cc.Node.EventType.MOUSE_DOWN,this.superCubeOn,this),n.on(cc.Node.EventType.MOUSE_DOWN,this.bombCubeOn,this)}this.game.on(cc.Node.EventType.MOUSE_DOWN,this.bombsOff,this)}},bombsOff:function(e){if("game"===e.target.name){this.bombs.getComponent("bombs").changeBombsLabelColor(!1);for(var o,n=t(this.node.children);!(o=n()).done;){var r=o.value;r.off(cc.Node.EventType.MOUSE_DOWN,this.bombCubeOn,this),"super"===r.getComponent(cc.Sprite).spriteFrame.name?r.on(cc.Node.EventType.MOUSE_DOWN,this.superCubeOn,this):r.on(cc.Node.EventType.MOUSE_DOWN,this.cubeOn,this)}this.game.off(cc.Node.EventType.MOUSE_DOWN,this.bombsOff,this)}}}),cc._RF.pop()},{config:"config",logic:"logic"}],goal:[function(e,o){"use strict";cc._RF.push(o,"069caLDrT5M0JgZTK2Ayvtq","goal");var t=e("config"),n=e("logic");cc.Class({extends:cc.Component,properties:{number:{default:null,type:cc.Node},cube:{default:null,type:cc.Node},red:{default:null,type:cc.SpriteFrame},green:{default:null,type:cc.SpriteFrame},blue:{default:null,type:cc.SpriteFrame},yellow:{default:null,type:cc.SpriteFrame},purple:{default:null,type:cc.SpriteFrame},bar:{default:null,type:cc.Node},persist:{default:null,type:cc.Node}},onLoad:function(){this.goalNumber=t.startGoalNumber,this.goalRender()},goalRender:function(){this.number.getComponent(cc.Label).string=this.goalNumber,this.cube.getComponent(cc.Sprite).spriteFrame=this[n.goalColor],this.bar.getComponent(cc.Sprite).fillRange=n.getBarFillRange(this.goalNumber)},goalProgress:function(e){this.goalNumber-=e,this.goalNumber<=0&&(this.goalNumber=0,this.persist.getComponent("persist").changeStatus("VICTORY"),cc.director.loadScene("result")),this.goalRender()}}),cc._RF.pop()},{config:"config",logic:"logic"}],logic:[function(e,o){"use strict";function t(e,o){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=n(e))||o&&e&&"number"==typeof e.length){t&&(e=t);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}function n(e,o){if(e){if("string"==typeof e)return r(e,o);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?r(e,o):void 0}}function r(e,o){(null==o||o>e.length)&&(o=e.length);for(var t=0,n=new Array(o);t<o;t++)n[t]=e[t];return n}cc._RF.push(o,"2ab5fZwfTlKbIpHpimRC5H3","logic");var s=e("config");o.exports={init:function(){this.cubes=[];for(var e=0;e<s.rowsCount;e++){this.cubes[e]=[];for(var o=0;o<s.columnsCount;o++){var t=this.randomColor();this.cubes[e][o]={row:e,column:o,color:t}}}this.goalColor=this.randomColor()},randomColor:function(){return s.colors[Math.floor(Math.random()*s.colors.length)]},isExistingCoordinate:function(e,o){return e>=0&&e<s.rowsCount&&o>=0&&o<s.columnsCount},getCubesToDestroy:function(e,o,t){var n=[this.cubes[e][o]];switch(t){case"super":this.calculateCubesToDestroyBySuper(e,o,n);break;case"bomb":this.calculateCubesToDestroyByBomb(e,o,n);break;default:this.calculateCubesToDestroy(e,o,n)}return n},calculateCubesToDestroy:function(e,o,t){var n=this,r=function(e,o){if(n.isExistingCoordinate(e,o)){var r=n.cubes[e][o];t.includes(r)||r.color!==t[0].color||(t.push(r),n.calculateCubesToDestroy(e,o,t))}};r(e,o-1),r(e,o+1),r(e-1,o),r(e+1,o)},calculateCubesToDestroyBySuper:function(e,o,t){for(var n=this,r=function(e,o){var r=n.cubes[e][o];t.includes(r)||(t.push(r),"super"===r.color&&n.calculateCubesToDestroyBySuper(r.row,r.column,t))},c=0;c<s.rowsCount;c++)r(c,o);for(var i=0;i<s.columnsCount;i++)r(e,i)},calculateCubesToDestroyByBomb:function(e,o,t){for(var n=e-s.bombsRadius,r=o-s.bombsRadius,c=n;c<n+2*s.bombsRadius+1;c++)for(var i=r;i<r+2*s.bombsRadius+1;i++)if(this.isExistingCoordinate(c,i)){var u=this.cubes[c][i];t.includes(u)||t.push(u),"super"===u.color&&this.calculateCubesToDestroyBySuper(u.row,u.column,t)}},calculateCubesChanges:function(e){for(var o=s.rowsCount;o<2*s.rowsCount;o++)this.cubes[o]=[];for(var n,r=t(e);!(n=r()).done;){for(var c=n.value,i=s.rowsCount;this.cubes[i][c.column];)i+=1;delete this.cubes[c.row][c.column];var u=this.randomColor();this.cubes[i][c.column]={row:i,column:c.column,color:u}}for(var l,a=[],b=t(e);!(l=b()).done;){var f=l.value;a.includes(f.column)||a.push(f.column)}for(var p=0,h=a;p<h.length;p++)for(var m=h[p],d=0,g=0;g<this.cubes.length;g++){var v=this.cubes[g][m];if(v){if(v&&d){var C=g-d;this.cubes[C][m]={row:C,column:m,color:v.color,prevRow:g}}}else d+=1}this.cubes.splice(s.rowsCount,this.cubes.length-s.rowsCount)},saveSuperCube:function(e){e[0].color="super",e.splice(0,1)},getGoalCubes:function(e){for(var o,n=[],r=t(e);!(o=r()).done;){var s=o.value;s.color===this.goalColor&&n.push(s)}return n},getPrevRowsCount:function(){for(var e=0,o=0;o<s.rowsCount;o++)for(var t=0;t<s.columnsCount;t++)this.cubes[o][t].prevRow&&(e+=1);return e},deletePrevRows:function(){for(var e=0;e<s.rowsCount;e++)for(var o=0;o<s.columnsCount;o++)this.cubes[e][o].prevRow&&delete this.cubes[e][o].prevRow},isAvailableMoves:function(){for(var e=0;e<s.rowsCount;e++)for(var o=0;o<s.columnsCount-1;o++)if(this.cubes[e][o].color===this.cubes[e][o+1].color)return!0;for(var t=0;t<s.columnsCount;t++)for(var n=0;n<s.rowsCount-1;n++)if(this.cubes[n][t].color===this.cubes[n+1][t].color)return!0},reshuffleCubes:function(){for(var e=0;e<s.rowsCount;e++)for(var o=0;o<s.columnsCount;o++)this.cubes[e][o].color=this.randomColor()},getBarFillRange:function(e){return(100-e/s.startGoalNumber*100)/100},getPoints:function(e){return e>s.minCubesCountForDestroy?e*s.pointsPerCube+(e-s.minCubesCountForDestroy)*s.pointsPerCube:e*s.pointsPerCube}},cc._RF.pop()},{config:"config"}],moves:[function(e,o){"use strict";cc._RF.push(o,"0af83xPWC5J2pSNGVR8sI0B","moves");var t=e("config");e("logic"),cc.Class({extends:cc.Component,properties:{persist:{default:null,type:cc.Node}},onLoad:function(){this.moves=t.startMoves,this.movesRender()},movesRender:function(){this.node.getComponent(cc.Label).string=this.moves},movesReduce:function(){this.moves-=1,0===this.moves&&(this.persist.getComponent("persist").changeStatus("DEFEAT"),cc.director.loadScene("result")),this.movesRender()}}),cc._RF.pop()},{config:"config",logic:"logic"}],persist:[function(e,o){"use strict";cc._RF.push(o,"1bd6eKDCxJKwomBCP7ayU3L","persist"),cc.Class({extends:cc.Component,onLoad:function(){cc.game.addPersistRootNode(this.node)},changeStatus:function(e){this.status=e},changeScore:function(e){this.score=e}}),cc._RF.pop()},{}],result:[function(e,o){"use strict";cc._RF.push(o,"b08a6cVvstNWrEo1qwyFJBk","result"),cc.Class({extends:cc.Component,properties:{status:{default:null,type:cc.Node},score:{default:null,type:cc.Node}},onLoad:function(){var e=cc.find("persist");cc.game.removePersistRootNode(e),this.status.getComponent(cc.Label).string=e.getComponent("persist").status,this.score.getComponent(cc.Label).string="Score: "+e.getComponent("persist").score}}),cc._RF.pop()},{}],score:[function(e,o){"use strict";cc._RF.push(o,"37c3b6eGedDvL92mW5LfdcP","score");var t=e("config"),n=e("logic");cc.Class({extends:cc.Component,properties:{persist:{default:null,type:cc.Node}},onLoad:function(){this.score=0,this.scoreRender()},scoreRender:function(e){var o=this;if(e)var n=setInterval(function(){(e-=t.pointsPerCube)||clearTimeout(n),o.node.getComponent(cc.Label).string=o.score-e},1e3*t.timeOfScoreStep);else this.node.getComponent(cc.Label).string=this.score},scoreProgress:function(e){var o=n.getPoints(e);this.score+=o,this.persist.getComponent("persist").changeScore(this.score),this.scoreRender(o)}}),cc._RF.pop()},{config:"config",logic:"logic"}]},{},["bombs","config","cubes","goal","logic","moves","persist","result","score"]);